import{aP as Pe,r as C,c as I,aY as re,x as o,y as n,z as e,O as v,L as T,P as i,u as t,C as M,K as ge,aW as Le,aa as ke,f as he,aq as Se,Y as Ie,Q as J,ac as Z,B as de,R as te,q as Te,o as pe,V as Ae,I as me,aV as _e,a5 as De,aX as Re,J as we,av as je}from"./vue-vendor-DV7DYXbz.js";import{bf as $e,bg as Ce,bh as ce,b1 as Ue,bi as qe,bj as Ee,bk as Ne,_ as le,f as O,Z as Ke,c as Oe,aH as Fe,aO as We,a as Ve}from"./index-Cw_WZoB5.js";import{L as Be}from"./LogoTitle-C8tZmMwK.js";import{T as ze}from"./ThemeToggle-DCjCCOMZ.js";import"./vendor-Dr8jvgFu.js";import{_ as Ge}from"./WindowCountdown-Cz478C_V.js";import{T as He}from"./TutorialView-DT-_DzqR.js";import"./element-plus-BSjV1f9S.js";const ne=Pe("apistats",()=>{const j=C(""),_=C(null),r=C(!1),p=C(!1),c=C(!0),f=C(""),y=C("daily"),h=C(null),$=C([]),L=C([]),D=C([]),g=C([]),x=C(null),A=C(null),m=C(null),a=C({siteName:"",siteIcon:"",siteIconData:""}),b=C(!1),P=C([]),R=C([]),U=C(null),N=C([]),F=C([]),W=C(null),Y=C({}),Q=I(()=>{const u={requests:0,inputTokens:0,outputTokens:0,cacheCreateTokens:0,cacheReadTokens:0,allTokens:0,cost:0,formattedCost:"$0.000000"};return b.value&&U.value?y.value==="daily"?U.value.dailyUsage||u:y.value==="monthly"?U.value.monthlyUsage||u:U.value.alltimeUsage||u:y.value==="daily"?x.value||u:y.value==="monthly"?A.value||u:m.value||u}),E=I(()=>{if(!h.value||!Q.value)return{tokenUsage:0,costUsage:0,requestUsage:0};const u=Q.value,k=h.value.limits;return{tokenUsage:k.tokenLimit>0?Math.min(u.allTokens/k.tokenLimit*100,100):0,costUsage:k.dailyCostLimit>0?Math.min(u.cost/k.dailyCostLimit*100,100):0,requestUsage:k.rateLimitRequests>0?Math.min(u.requests/k.rateLimitRequests*100,100):0}});async function S(){if(b.value)return H();const u=j.value.trim();if(!u){f.value="请输入 API Key";return}if(u.length<10||u.length>512){f.value="API Key 格式无效：长度应在 10-512 个字符之间";return}r.value=!0,f.value="",h.value=null,$.value=[],_.value=null;try{const k=await $e(u);if(k.success){_.value=k.data.id;const K=await Ce(_.value);if(K.success)h.value=K.data,Y.value=K.data.serviceRates||{},await X(),f.value="",ie(),ue();else throw new Error(K.message||"查询失败")}else throw new Error(k.message||"获取 API Key ID 失败")}catch(k){console.error("Query stats error:",k),f.value=k.message||"查询统计数据失败，请检查您的 API Key 是否正确",h.value=null,$.value=[],_.value=null}finally{r.value=!1}}async function X(){_.value&&(await Promise.all([G("daily"),G("monthly")]),await ee())}async function ee(){if(_.value){p.value=!0;try{const[u,k,K]=await Promise.all([ce(_.value,"daily"),ce(_.value,"monthly"),ce(_.value,"alltime")]);L.value=u.success?u.data||[]:[],D.value=k.success?k.data||[]:[],g.value=K.success?K.data||[]:[],$.value=L.value}catch(u){console.error("Load all model stats error:",u),L.value=[],D.value=[],g.value=[],$.value=[]}finally{p.value=!1}}}async function G(u){try{const k=await ce(_.value,u);if(k.success){const K=k.data||[],B={requests:0,inputTokens:0,outputTokens:0,cacheCreateTokens:0,cacheReadTokens:0,allTokens:0,cost:0,formattedCost:"$0.000000"};K.forEach(z=>{var ae;B.requests+=z.requests||0,B.inputTokens+=z.inputTokens||0,B.outputTokens+=z.outputTokens||0,B.cacheCreateTokens+=z.cacheCreateTokens||0,B.cacheReadTokens+=z.cacheReadTokens||0,B.allTokens+=z.allTokens||0,B.cost+=((ae=z.costs)==null?void 0:ae.total)||0}),B.formattedCost=V(B.cost),u==="daily"?x.value=B:u==="monthly"?A.value=B:u==="alltime"&&(m.value=B)}else console.warn(`Failed to load ${u} stats:`,k.message)}catch(k){console.error(`Load ${u} stats error:`,k)}}async function l(u="daily"){if(_.value){p.value=!0;try{const k=await ce(_.value,u);if(k.success)$.value=k.data||[];else throw new Error(k.message||"加载模型统计失败")}catch(k){console.error("Load model stats error:",k),$.value=[]}finally{p.value=!1}}}async function s(u){if(!(y.value===u||p.value)){if(y.value=u,b.value&&R.value.length>0){await se(u);return}(u==="daily"&&!x.value||u==="monthly"&&!A.value||u==="alltime"&&!m.value)&&await G(u),await l(u)}}async function d(){var u,k;if(_.value){r.value=!0,f.value="",h.value=null,$.value=[];try{const K=await Ce(_.value);if(K.success)h.value=K.data,Y.value=K.data.serviceRates||{},console.log("API Stats - Full response:",K.data),console.log("API Stats - limits data:",K.data.limits),console.log("API Stats - weeklyOpusCostLimit:",(u=K.data.limits)==null?void 0:u.weeklyOpusCostLimit),console.log("API Stats - weeklyOpusCost:",(k=K.data.limits)==null?void 0:k.weeklyOpusCost),await X(),f.value="";else throw new Error(K.message||"查询失败")}catch(K){console.error("Load stats with apiId error:",K),f.value=K.message||"查询统计数据失败",h.value=null,$.value=[]}finally{r.value=!1}}}async function w(){c.value=!0;try{const u=await Ue();u&&u.success&&u.data&&(a.value={...a.value,...u.data})}catch(u){console.error("Error loading OEM settings:",u),a.value={siteName:"Whoos Solutions API Hub",siteIcon:"",siteIconData:""}}finally{c.value=!1}}async function q(){try{const u=await qe();u&&u.success&&u.data&&(W.value=u.data)}catch(u){console.error("Error loading service rates:",u),W.value=null}}function V(u){return typeof u!="number"||u===0?"$0.000000":u>=1?"$"+u.toFixed(2):u>=.01?"$"+u.toFixed(4):"$"+u.toFixed(6)}function ie(){if(_.value){const u=new URL(window.location);u.searchParams.set("apiId",_.value),window.history.pushState({},"",u)}}function ue(){j.value&&localStorage.setItem("lastApiKey",j.value)}function oe(){return localStorage.getItem("lastApiKey")}async function H(){const u=xe();if(u.length===0){f.value="请输入至少一个有效的 API Key";return}r.value=!0,f.value="",U.value=null,N.value=[],F.value=[],$.value=[],P.value=u,R.value=[],Y.value={};try{const k=await Promise.allSettled(u.map(ae=>$e(ae))),K=[],B=[];if(k.forEach((ae,be)=>{ae.status==="fulfilled"&&ae.value.success?(K.push(ae.value.data.id),B.push(u[be])):F.value.push(u[be])}),K.length===0)throw new Error("所有 API Key 都无效");R.value=K,P.value=B;const z=await Ee(K);if(z.success)U.value=z.data.aggregated,N.value=z.data.individual,h.value=z.data.aggregated,x.value=z.data.aggregated.dailyUsage||null,A.value=z.data.aggregated.monthlyUsage||null,await se(y.value),fe();else throw new Error(z.message||"批量查询失败")}catch(k){console.error("Batch query error:",k),f.value=k.message||"批量查询统计数据失败",U.value=null,N.value=[]}finally{r.value=!1}}async function se(u="daily"){if(R.value.length!==0){p.value=!0;try{const k=await Ne(R.value,u);if(k.success)$.value=k.data||[];else throw new Error(k.message||"加载批量模型统计失败")}catch(k){console.error("Load batch model stats error:",k),$.value=[]}finally{p.value=!1}}}function xe(){if(!j.value)return[];const u=j.value.split(/[,\n]+/).map(K=>K.trim()).filter(K=>K.length>=10&&K.length<=512);return[...new Set(u)].slice(0,30)}function fe(){if(R.value.length>0){const u=new URL(window.location);u.searchParams.set("apiIds",R.value.join(",")),u.searchParams.set("batch","true"),window.history.pushState({},"",u)}}function ye(){j.value=""}function ve(){h.value=null,$.value=[],L.value=[],D.value=[],g.value=[],x.value=null,A.value=null,m.value=null,f.value="",y.value="daily",_.value=null,Y.value={},P.value=[],R.value=[],U.value=null,N.value=[],F.value=[]}function Me(){j.value="",b.value=!1,ve()}return{apiKey:j,apiId:_,loading:r,modelStatsLoading:p,oemLoading:c,error:f,statsPeriod:y,statsData:h,modelStats:$,dailyModelStats:L,monthlyModelStats:D,alltimeModelStats:g,dailyStats:x,monthlyStats:A,alltimeStats:m,oemSettings:a,multiKeyMode:b,apiKeys:P,apiIds:R,aggregatedStats:U,individualStats:N,invalidKeys:F,serviceRates:W,keyServiceRates:Y,currentPeriodData:Q,usagePercentages:E,queryStats:S,queryBatchStats:H,loadAllPeriodStats:X,loadAllModelStats:ee,loadPeriodStats:G,loadModelStats:l,loadBatchModelStats:se,switchPeriod:s,loadStatsWithApiId:d,loadOemSettings:w,loadServiceRates:q,loadApiKeyFromStorage:oe,clearData:ve,clearInput:ye,reset:Me}}),Je={class:"api-input-wide-card mb-8 rounded-3xl p-6 shadow-xl"},Qe={class:"mx-auto max-w-4xl"},Ye={class:"control-bar mb-4 flex flex-wrap items-center justify-between gap-3"},Xe={class:"text-sm font-medium text-gray-700 dark:text-gray-300"},Ze={class:"button-group flex items-center gap-2"},et={class:"mode-switch-group flex items-center rounded-lg bg-gray-100 p-1 dark:bg-gray-800"},tt={key:0,class:"ml-1 rounded-full bg-white/20 px-1.5 py-0.5 text-xs font-semibold"},st={class:"api-input-grid grid grid-cols-1 gap-4 lg:grid-cols-4"},at={class:"lg:col-span-3"},rt={key:0,class:"relative"},lt=["disabled","type"],nt={key:1,class:"relative"},it=["disabled"],ot={class:"lg:col-span-1"},dt=["disabled"],ut={key:0,class:"fas fa-spinner loading-spinner"},ct={key:1,class:"fas fa-search"},mt={class:"security-notice mt-4"},gt={key:0,class:"mt-2 rounded-lg bg-blue-50 p-3 text-sm text-blue-700 dark:bg-blue-900/20 dark:text-blue-400"},xt={__name:"ApiKeyInput",setup(j){const _=ne(),{apiKey:r,loading:p,multiKeyMode:c}=re(_),{queryStats:f,clearInput:y}=_,h=C(!1),$=I(()=>{if(!c.value||!r.value)return[];const D=r.value.split(/[,\n]+/).map(x=>x.trim()).filter(x=>x.length>0);return[...new Set(D)].slice(0,30)}),L=I(()=>c.value?$.value.length>0:r.value&&r.value.trim().length>0);return(D,g)=>(n(),o("div",Je,[g[16]||(g[16]=e("div",{class:"wide-card-title mb-6"},[e("h2",{class:"mb-2 text-2xl font-bold text-gray-900 dark:text-gray-200"},[e("i",{class:"fas fa-chart-line mr-3"}),v(" 使用统计查询 ")]),e("p",{class:"text-base text-gray-600 dark:text-gray-400"},"查询您的 API Key 使用情况和统计数据")],-1)),e("div",Qe,[e("div",Ye,[e("label",Xe,[g[9]||(g[9]=e("i",{class:"fas fa-key mr-2"},null,-1)),v(" "+i(t(c)?"输入您的 API Keys（每行一个或用逗号分隔）":"输入您的 API Key"),1)]),e("div",Ze,[e("div",et,[e("button",{class:M(["mode-switch-btn",{active:!t(c)}]),title:"单一模式",onClick:g[0]||(g[0]=x=>c.value=!1)},g[10]||(g[10]=[e("i",{class:"fas fa-key"},null,-1),e("span",{class:"ml-2 hidden sm:inline"},"单一",-1)]),2),e("button",{class:M(["mode-switch-btn",{active:t(c)}]),title:"聚合模式",onClick:g[1]||(g[1]=x=>c.value=!0)},[g[11]||(g[11]=e("i",{class:"fas fa-layer-group"},null,-1)),g[12]||(g[12]=e("span",{class:"ml-2 hidden sm:inline"},"聚合",-1)),t(c)&&$.value.length>0?(n(),o("span",tt,i($.value.length),1)):T("",!0)],2)])])]),e("div",st,[e("div",at,[t(c)?(n(),o("div",nt,[ge(e("textarea",{"onUpdate:modelValue":g[5]||(g[5]=x=>he(r)?r.value=x:null),class:"wide-card-input w-full resize-y",disabled:t(p),placeholder:`请输入您的 API Keys，支持以下格式：
cr_xxx
cr_yyy
或
cr_xxx, cr_yyy`,rows:"4",onKeyup:g[6]||(g[6]=ke(Ie((...x)=>t(f)&&t(f)(...x),["ctrl"]),["enter"]))},null,40,it),[[Se,t(r)]]),t(r)&&!t(p)?(n(),o("button",{key:0,class:"absolute right-2 top-2 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300",title:"清空输入",onClick:g[7]||(g[7]=(...x)=>t(y)&&t(y)(...x))},g[13]||(g[13]=[e("i",{class:"fas fa-times-circle"},null,-1)]))):T("",!0)])):(n(),o("div",rt,[ge(e("input",{"onUpdate:modelValue":g[2]||(g[2]=x=>he(r)?r.value=x:null),class:"wide-card-input w-full pr-10",disabled:t(p),placeholder:"请输入您的 API Key (cr_...)",type:h.value?"text":"password",onKeyup:g[3]||(g[3]=ke((...x)=>t(f)&&t(f)(...x),["enter"]))},null,40,lt),[[Le,t(r)]]),e("button",{class:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300",type:"button",onClick:g[4]||(g[4]=x=>h.value=!h.value)},[e("i",{class:M(h.value?"fas fa-eye-slash":"fas fa-eye")},null,2)])]))]),e("div",ot,[e("button",{class:"btn btn-primary btn-query flex h-full w-full items-center justify-center gap-2",disabled:t(p)||!L.value,onClick:g[8]||(g[8]=(...x)=>t(f)&&t(f)(...x))},[t(p)?(n(),o("i",ut)):(n(),o("i",ct)),v(" "+i(t(p)?"查询中...":"查询统计"),1)],8,dt)])]),e("div",mt,[g[14]||(g[14]=e("i",{class:"fas fa-shield-alt mr-2"},null,-1)),v(" "+i(t(c)?"您的 API Keys 仅用于查询统计数据，不会被存储。聚合模式下部分个体化信息将不显示。":"您的 API Key 仅用于查询自己的统计数据，不会被存储或用于其他用途"),1)]),t(c)?(n(),o("div",gt,g[15]||(g[15]=[e("i",{class:"fas fa-lightbulb mr-2"},null,-1),e("span",null,"提示：最多支持同时查询 30 个 API Keys。使用 Ctrl+Enter 快速查询。",-1)]))):T("",!0)])]))}},ft=le(xt,[["__scopeId","data-v-411fd161"]]),yt={class:"space-y-4 sm:space-y-6 md:space-y-8"},pt={class:"grid grid-cols-1 items-stretch gap-3 sm:gap-4 md:gap-6 xl:grid-cols-[minmax(0,1.5fr)_minmax(0,1fr)]"},vt={class:"card-section"},bt={class:"section-header"},kt={class:"header-title"},ht={key:0,class:"info-grid"},_t={class:"info-item"},wt={class:"info-value"},$t={class:"info-item"},Ct={class:"info-value text-green-600 dark:text-emerald-400"},St={key:0,class:"info-item"},Tt={class:"info-value text-red-500 dark:text-red-400"},At={class:"info-item"},Kt={class:"info-value"},Mt={class:"info-item"},Pt={class:"info-value"},Lt={class:"info-item"},It={class:"info-value text-indigo-600 dark:text-indigo-300"},Dt={key:1,class:"info-item xl:col-span-2"},Rt={class:"space-y-2"},jt={class:"truncate"},Ut={class:"font-semibold"},qt={key:1,class:"info-grid"},Et={class:"info-value flex items-center gap-1 break-all"},Nt={class:"info-item"},Ot={class:"info-item"},Ft={class:"info-value"},Wt={key:0,class:"info-item xl:col-span-2"},Vt={class:"flex flex-wrap gap-2"},Bt={class:"info-item"},zt={class:"info-value break-all"},Gt={class:"info-item xl:col-span-2"},Ht={class:"info-value"},Jt={class:"ml-2 text-xs text-gray-500 dark:text-gray-400"},Qt={key:0,class:"text-red-500 dark:text-red-400"},Yt={key:1,class:"text-orange-500 dark:text-orange-400"},Xt={key:2},Zt={key:2,class:"text-gray-400 dark:text-gray-500"},es={class:"card-section"},ts={class:"section-header"},ss={class:"header-tag"},as={class:"metric-grid"},rs={class:"metric-card"},ls={class:"metric-value text-green-600 dark:text-emerald-300"},ns={class:"metric-label"},is={class:"metric-card"},os={class:"metric-value text-blue-600 dark:text-sky-300"},ds={class:"metric-label"},us={class:"metric-card"},cs={class:"metric-value text-purple-600 dark:text-violet-300"},ms={class:"metric-label"},gs={class:"metric-card"},xs={class:"metric-value text-amber-500 dark:text-amber-300"},fs={class:"metric-label"},ys={key:0,class:"card-section"},ps={class:"flex items-center justify-between gap-3"},vs={class:"flex items-center gap-3"},bs={class:"account-name"},ks={class:"account-sub"},hs={key:0,class:"mt-3 space-y-2"},_s={class:"progress-row"},ws={class:"progress-track"},$s={class:"progress-value"},Cs={class:"flex flex-wrap items-center gap-2 text-xs text-gray-600 dark:text-gray-300"},Ss={key:0,class:"font-medium text-indigo-600 dark:text-indigo-400"},Ts={key:1,class:"mt-3"},As={key:0,class:"space-y-2"},Ks={class:"quota-header"},Ms={class:"quota-percent"},Ps={class:"progress-track"},Ls={class:"quota-foot"},Is={key:1,class:"rounded-xl bg-gray-100 px-3 py-2 text-xs text-gray-500 dark:bg-gray-800 dark:text-gray-300"},Ds={__name:"StatsOverview",setup(j){const _=ne(),{statsData:r,statsPeriod:p,currentPeriodData:c,multiKeyMode:f,aggregatedStats:y,individualStats:h,invalidKeys:$}=re(_),L=I(()=>!h.value||h.value.length===0?[]:[...h.value].sort((l,s)=>{var d,w;return(((d=s.usage)==null?void 0:d.allTokens)||0)-(((w=l.usage)==null?void 0:w.allTokens)||0)}).slice(0,3)),D=I(()=>{var l;return((l=r.value)==null?void 0:l.serviceRates)&&Object.keys(r.value.serviceRates).length>0}),g=l=>{var d;return!y.value||!y.value.usage.allTokens?0:((((d=l.usage)==null?void 0:d.allTokens)||0)/y.value.usage.allTokens*100).toFixed(1)},x=l=>l?new Date(l).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",A=l=>l?new Date(l)<new Date:!1,m=l=>{if(!l)return!1;const w=(new Date(l)-new Date)/(1e3*60*60*24);return w>0&&w<=7},a=l=>{const s={claude:"Claude",gemini:"Gemini",codex:"Codex",droid:"Droid",bedrock:"Bedrock",azure:"Azure",ccr:"CCR"};if(!l)return"全部服务";let d=l;if(typeof l=="string"){if(l==="all"||l==="[]")return"全部服务";try{d=JSON.parse(l)}catch{return s[l]||l}}return Array.isArray(d)&&d.length===0?"全部服务":Array.isArray(d)?d.map(w=>s[w]||w).join(", "):s[l]||l},b=I(()=>{var d,w;const l=(w=(d=r.value)==null?void 0:d.accounts)==null?void 0:w.details;if(!l)return[];const s=[];return l.claude&&l.claude.accountType==="dedicated"&&s.push({key:"claude",...l.claude}),l.openai&&l.openai.accountType==="dedicated"&&s.push({key:"openai",...l.openai}),s}),P=I(()=>{const l=b.value.length;return l<=1?"md:grid-cols-1 lg:grid-cols-1":l===2?"md:grid-cols-2":"md:grid-cols-2 xl:grid-cols-3"}),R=l=>l?l.platform==="openai"?"OpenAI 专属账号":"Claude 专属账号":"专属账号",U=l=>{if(!l||l<=0)return"";const s=Math.floor(l),d=Math.floor(s/1440),w=Math.floor(s%1440/60),q=s%60;return d>0?w>0?`${d}天${w}小时`:`${d}天`:w>0?q>0?`${w}小时${q}分钟`:`${w}小时`:`${q}分钟`},N=l=>{if(!l)return{text:"状态未知",class:"text-gray-400"};if(l.isRateLimited){const s=U(l.minutesRemaining);return{text:`限流中${s?` · 剩余约 ${s}`:""}`,class:"text-red-500 dark:text-red-400"}}return{text:"未限流",class:"text-green-600 dark:text-emerald-400"}},F=(l,s)=>{if(!l||!s)return"暂无时间窗口信息";const d=new Date(l),w=new Date(s),q=V=>`${`${V.getHours()}`.padStart(2,"0")}:${`${V.getMinutes()}`.padStart(2,"0")}`;return`${q(d)} - ${q(w)}`},W=l=>{if(!l||l<=0)return"";const s=Math.floor(l/60),d=l%60;return s>0?`${s}小时${d}分钟`:`${d}分钟`},Y=(l,s)=>{var w;if(!l)return"bg-gradient-to-r from-blue-500 to-indigo-500";if((w=s==null?void 0:s.rateLimitStatus)!=null&&w.isRateLimited)return"bg-gradient-to-r from-red-500 to-red-600";const d=String(l).toLowerCase();return d==="rejected"?"bg-gradient-to-r from-red-500 to-red-600":d==="allowed_warning"?"bg-gradient-to-r from-yellow-500 to-orange-500":"bg-gradient-to-r from-blue-500 to-indigo-500"},Q=l=>{if(!l)return null;const s=typeof l.usedPercent=="number"&&!Number.isNaN(l.usedPercent)?l.usedPercent:null,d=typeof l.resetAfterSeconds=="number"&&!Number.isNaN(l.resetAfterSeconds)?l.resetAfterSeconds:null,w=typeof l.remainingSeconds=="number"?l.remainingSeconds:null,q=l.resetAt?Date.parse(l.resetAt):null;return d!==null&&(w!==null&&w<=0||q!==null&&!Number.isNaN(q)&&Date.now()>=q)?0:s===null?null:Math.max(0,Math.min(100,s))},E=l=>{const s=Q(l);return s===null?"bg-gradient-to-r from-gray-300 to-gray-400":s>=90?"bg-gradient-to-r from-red-500 to-red-600":s>=75?"bg-gradient-to-r from-yellow-500 to-orange-500":"bg-gradient-to-r from-emerald-500 to-teal-500"},S=l=>{const s=Q(l);return s===null?"0%":`${s}%`},X=l=>{const s=Q(l);return s===null?"--":`${s.toFixed(1)}%`},ee=l=>{if(!l)return"--";let s=l.remainingSeconds;if(s==null&&(s=l.resetAfterSeconds),s==null||Number.isNaN(Number(s)))return"--";s=Math.max(0,Math.floor(Number(s)));const d=Math.floor(s/86400),w=Math.floor(s%86400/3600),q=Math.floor(s%3600/60),V=s%60;return d>0?w>0?`${d}天${w}小时`:`${d}天`:w>0?q>0?`${w}小时${q}分钟`:`${w}小时`:q>0?`${q}分钟`:`${V}秒`},G=l=>l==="secondary"?"周限":"5h";return(l,s)=>(n(),o("div",yt,[e("div",pt,[e("div",vt,[e("header",bt,[e("i",{class:M(["header-icon",t(f)?"fas fa-layer-group text-purple-500":"fas fa-info-circle text-blue-500"])},null,2),e("h3",kt,i(t(f)?"批量查询概要":"API Key 信息"),1)]),t(f)&&t(y)?(n(),o("div",ht,[e("div",_t,[s[1]||(s[1]=e("p",{class:"info-label"},"查询 Keys 数",-1)),e("p",wt,i(t(y).totalKeys)+" 个",1)]),e("div",$t,[s[3]||(s[3]=e("p",{class:"info-label"},"有效 Keys 数",-1)),e("p",Ct,[s[2]||(s[2]=e("i",{class:"fas fa-check-circle mr-1"},null,-1)),v(i(t(y).activeKeys)+" 个 ",1)])]),t($).length>0?(n(),o("div",St,[s[5]||(s[5]=e("p",{class:"info-label"},"无效 Keys 数",-1)),e("p",Tt,[s[4]||(s[4]=e("i",{class:"fas fa-times-circle mr-1"},null,-1)),v(i(t($).length)+" 个 ",1)])])):T("",!0),e("div",At,[s[6]||(s[6]=e("p",{class:"info-label"},"总请求数",-1)),e("p",Kt,i(t(O)(t(y).usage.requests)),1)]),e("div",Mt,[s[7]||(s[7]=e("p",{class:"info-label"},"总 Token 数",-1)),e("p",Pt,i(t(O)(t(y).usage.allTokens)),1)]),e("div",Lt,[s[8]||(s[8]=e("p",{class:"info-label"},"总费用",-1)),e("p",It,i(t(y).usage.formattedCost),1)]),t(h).length>1?(n(),o("div",Dt,[s[9]||(s[9]=e("p",{class:"info-label"},"Top 3 贡献占比",-1)),e("div",Rt,[(n(!0),o(J,null,Z(L.value,d=>(n(),o("div",{key:d.apiId,class:"contributor-item"},[e("span",jt,i(d.name),1),e("span",Ut,i(g(d))+"%",1)]))),128))])])):T("",!0)])):(n(),o("div",qt,[e("div",{class:"info-item cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700/50",title:"点击复制",onClick:s[0]||(s[0]=d=>t(Ke)(t(r).name))},[s[11]||(s[11]=e("p",{class:"info-label"},"名称",-1)),e("p",Et,[v(i(t(r).name)+" ",1),s[10]||(s[10]=e("i",{class:"fas fa-copy text-xs text-gray-400"},null,-1))])]),e("div",Nt,[s[12]||(s[12]=e("p",{class:"info-label"},"状态",-1)),e("p",{class:M(["info-value font-semibold",t(r).isActive?"text-green-600 dark:text-emerald-400":"text-red-500 dark:text-red-400"])},[e("i",{class:M(["mr-1",t(r).isActive?"fas fa-check-circle":"fas fa-times-circle"])},null,2),v(" "+i(t(r).isActive?"活跃":"已停用"),1)],2)]),e("div",Ot,[s[13]||(s[13]=e("p",{class:"info-label"},"权限",-1)),e("p",Ft,i(a(t(r).permissions)),1)]),D.value?(n(),o("div",Wt,[s[14]||(s[14]=e("p",{class:"info-label"},"服务倍率",-1)),e("div",Vt,[(n(!0),o(J,null,Z(t(r).serviceRates,(d,w)=>(n(),o("span",{key:w,class:"inline-flex items-center rounded-full bg-purple-100 px-2.5 py-0.5 text-xs font-medium text-purple-800 dark:bg-purple-900/30 dark:text-purple-300"},i(w)+": "+i(d)+"x ",1))),128))])])):T("",!0),e("div",Bt,[s[15]||(s[15]=e("p",{class:"info-label"},"创建时间",-1)),e("p",zt,i(t(Oe)(t(r).createdAt)),1)]),e("div",Gt,[s[20]||(s[20]=e("p",{class:"info-label"},"过期时间",-1)),e("div",Ht,[t(r).expirationMode==="activation"&&!t(r).isActivated?(n(),o(J,{key:0},[s[16]||(s[16]=e("span",{class:"text-amber-600 dark:text-amber-400"},[e("i",{class:"fas fa-pause-circle mr-1"}),v("未激活 ")],-1)),e("span",Jt," 首次使用后 "+i(t(r).activationDays||(t(r).activationUnit==="hours"?24:30))+" "+i(t(r).activationUnit==="hours"?"小时":"天")+"过期 ",1)],64)):t(r).expiresAt?(n(),o(J,{key:1},[A(t(r).expiresAt)?(n(),o("span",Qt,s[17]||(s[17]=[e("i",{class:"fas fa-exclamation-circle mr-1"},null,-1),v("已过期 ",-1)]))):m(t(r).expiresAt)?(n(),o("span",Yt,[s[18]||(s[18]=e("i",{class:"fas fa-clock mr-1"},null,-1)),v(i(x(t(r).expiresAt)),1)])):(n(),o("span",Xt,i(x(t(r).expiresAt)),1))],64)):(n(),o("span",Zt,s[19]||(s[19]=[e("i",{class:"fas fa-infinity mr-1"},null,-1),v("永不过期 ",-1)])))])])]))]),e("div",es,[e("header",ts,[s[21]||(s[21]=e("i",{class:"header-icon fas fa-chart-bar text-green-500"},null,-1)),s[22]||(s[22]=e("h3",{class:"header-title"},"使用统计概览",-1)),e("span",ss,i(t(p)==="daily"?"今日":"本月"),1)]),e("div",as,[e("div",rs,[e("p",ls,i(t(O)(t(c).requests)),1),e("p",ns,i(t(p)==="daily"?"今日":"本月")+"请求数",1)]),e("div",is,[e("p",os,i(t(O)(t(c).allTokens)),1),e("p",ds,i(t(p)==="daily"?"今日":"本月")+"Token 数",1)]),e("div",us,[e("p",cs,i(t(c).formattedCost||"$0.000000"),1),e("p",ms,i(t(p)==="daily"?"今日":"本月")+"费用",1)]),e("div",gs,[e("p",xs,i(t(O)(t(c).inputTokens)),1),e("p",fs,i(t(p)==="daily"?"今日":"本月")+"输入 Token",1)])])])]),!t(f)&&b.value.length>0?(n(),o("div",ys,[s[24]||(s[24]=e("header",{class:"section-header"},[e("i",{class:"header-icon fas fa-plug text-indigo-500"}),e("h3",{class:"header-title"},"专属账号运行状态"),e("span",{class:"header-tag"},"实时更新")],-1)),e("div",{class:M(["grid grid-cols-1 gap-4",P.value])},[(n(!0),o(J,null,Z(b.value,d=>{var w,q,V,ie,ue,oe;return n(),o("div",{key:d.id||d.key,class:"account-card"},[e("div",ps,[e("div",vs,[e("span",{class:M(["account-icon",d.platform==="claude"?"icon-claude":"icon-openai"])},[e("i",{class:M(d.platform==="claude"?"fas fa-meteor":"fas fa-robot")},null,2)],2),e("div",null,[e("p",bs,i(R(d)),1),e("p",ks,i(d.platform==="claude"?"会话窗口":"额度窗口"),1)])]),N(d.rateLimitStatus)?(n(),o("div",{key:0,class:M(["rate-badge",N(d.rateLimitStatus).class])},[s[23]||(s[23]=e("i",{class:"fas fa-tachometer-alt mr-1"},null,-1)),v(" "+i(N(d.rateLimitStatus).text),1)],2)):T("",!0)]),d.platform==="claude"?(n(),o("div",hs,[e("div",_s,[e("div",ws,[e("div",{class:M(["progress-bar",Y((w=d.sessionWindow)==null?void 0:w.sessionWindowStatus,d)]),style:de({width:`${Math.min(100,Math.max(0,((q=d.sessionWindow)==null?void 0:q.progress)||0))}%`})},null,6)]),e("span",$s,i(Math.min(100,Math.max(0,Math.round(((V=d.sessionWindow)==null?void 0:V.progress)||0))))+"% ",1)]),e("div",Cs,[e("span",null,i(F((ie=d.sessionWindow)==null?void 0:ie.windowStart,(ue=d.sessionWindow)==null?void 0:ue.windowEnd)),1),((oe=d.sessionWindow)==null?void 0:oe.remainingTime)>0?(n(),o("span",Ss," 剩余 "+i(W(d.sessionWindow.remainingTime)),1)):T("",!0)])])):d.platform==="openai"?(n(),o("div",Ts,[d.codexUsage?(n(),o("div",As,[(n(),o(J,null,Z(["primary","secondary"],H=>{var se,xe,fe,ye;return e("div",{key:`${d.key}-${H}`,class:"quota-row"},[e("div",Ks,[e("span",{class:M(["quota-tag",H==="primary"?"tag-indigo":"tag-blue"])},i(G(H)),3),e("span",Ms,i(X((se=d.codexUsage)==null?void 0:se[H])),1)]),e("div",Ps,[e("div",{class:M(["progress-bar",E((xe=d.codexUsage)==null?void 0:xe[H])]),style:de({width:S((fe=d.codexUsage)==null?void 0:fe[H])})},null,6)]),e("div",Ls," 重置剩余 "+i(ee((ye=d.codexUsage)==null?void 0:ye[H])),1)])}),64))])):(n(),o("p",Is," 暂无额度使用数据 "))])):T("",!0)])}),128))],2)])):T("",!0)]))}},Rs=le(Ds,[["__scopeId","data-v-99d8ab54"]]),js={class:"card p-3 sm:p-4 md:p-6"},Us={class:"mb-2 flex flex-col text-base font-bold text-gray-900 dark:text-gray-100 sm:mb-3 sm:flex-row sm:items-center sm:text-lg md:mb-4 md:text-xl"},qs={class:"text-xs font-normal text-gray-600 dark:text-gray-400 sm:ml-2 md:text-sm"},Es={class:"space-y-2 md:space-y-3"},Ns={class:"flex items-center justify-between"},Os={class:"text-sm font-medium text-gray-900 dark:text-gray-100 md:text-base"},Fs={class:"flex items-center justify-between"},Ws={class:"text-sm font-medium text-gray-900 dark:text-gray-100 md:text-base"},Vs={class:"flex items-center justify-between"},Bs={class:"text-sm font-medium text-gray-900 dark:text-gray-100 md:text-base"},zs={class:"flex items-center justify-between"},Gs={class:"text-sm font-medium text-gray-900 dark:text-gray-100 md:text-base"},Hs={class:"mt-3 border-t border-gray-200 pt-3 dark:border-gray-700 md:mt-4 md:pt-4"},Js={class:"flex items-center justify-between font-bold text-gray-900 dark:text-gray-100"},Qs={class:"text-sm md:text-base"},Ys={class:"text-lg md:text-xl"},Xs={__name:"TokenDistribution",setup(j){const _=ne(),{statsPeriod:r,currentPeriodData:p}=re(_);return(c,f)=>(n(),o("div",js,[e("h3",Us,[f[0]||(f[0]=e("span",{class:"flex items-center"},[e("i",{class:"fas fa-coins mr-2 text-sm text-yellow-500 md:mr-3 md:text-base"}),v(" Token 使用分布 ")],-1)),e("span",qs,"("+i(t(r)==="daily"?"今日":"本月")+")",1)]),e("div",Es,[e("div",Ns,[f[1]||(f[1]=e("span",{class:"flex items-center text-sm text-gray-600 dark:text-gray-400 md:text-base"},[e("i",{class:"fas fa-arrow-right mr-1 text-xs text-green-500 md:mr-2 md:text-sm"}),v(" 输入 Token ")],-1)),e("span",Os,i(t(O)(t(p).inputTokens)),1)]),e("div",Fs,[f[2]||(f[2]=e("span",{class:"flex items-center text-sm text-gray-600 dark:text-gray-400 md:text-base"},[e("i",{class:"fas fa-arrow-left mr-1 text-xs text-blue-500 md:mr-2 md:text-sm"}),v(" 输出 Token ")],-1)),e("span",Ws,i(t(O)(t(p).outputTokens)),1)]),e("div",Vs,[f[3]||(f[3]=e("span",{class:"flex items-center text-sm text-gray-600 dark:text-gray-400 md:text-base"},[e("i",{class:"fas fa-save mr-1 text-xs text-purple-500 md:mr-2 md:text-sm"}),v(" 缓存创建 Token ")],-1)),e("span",Bs,i(t(O)(t(p).cacheCreateTokens)),1)]),e("div",zs,[f[4]||(f[4]=e("span",{class:"flex items-center text-sm text-gray-600 dark:text-gray-400 md:text-base"},[e("i",{class:"fas fa-download mr-1 text-xs text-orange-500 md:mr-2 md:text-sm"}),v(" 缓存读取 Token ")],-1)),e("span",Gs,i(t(O)(t(p).cacheReadTokens)),1)])]),e("div",Hs,[e("div",Js,[e("span",Qs,i(t(r)==="daily"?"今日":"本月")+"总计",1),e("span",Ys,i(t(O)(t(p).allTokens)),1)])])]))}},Zs=le(Xs,[["__scopeId","data-v-f3f6aa17"]]),ea={class:"flex h-full flex-col gap-3 sm:gap-4 md:gap-6"},ta={class:"card flex h-full flex-col p-3 sm:p-4 md:p-6"},sa={class:"mb-2 flex items-center text-base font-bold text-gray-900 dark:text-gray-100 sm:mb-3 sm:text-lg md:mb-4 md:text-xl"},aa={key:0,class:"space-y-4"},ra={class:"rounded-lg bg-gradient-to-r from-blue-50 to-indigo-50 p-4 dark:from-blue-900/20 dark:to-indigo-900/20"},la={class:"mb-3 flex items-center justify-between"},na={class:"rounded-full bg-blue-100 px-2 py-1 text-xs font-semibold text-blue-700 dark:bg-blue-800 dark:text-blue-200"},ia={class:"grid grid-cols-2 gap-3"},oa={class:"text-center"},da={class:"text-lg font-bold text-gray-900 dark:text-gray-100"},ua={class:"text-center"},ca={class:"text-lg font-bold text-green-600"},ma={class:"rounded-lg bg-gradient-to-r from-purple-50 to-pink-50 p-4 dark:from-purple-900/20 dark:to-pink-900/20"},ga={class:"space-y-2"},xa={class:"flex items-center justify-between"},fa={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},ya={class:"flex items-center justify-between"},pa={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},va={class:"flex items-center justify-between"},ba={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},ka={key:0,class:"rounded-lg bg-red-50 p-3 text-sm dark:bg-red-900/20"},ha={class:"text-red-700 dark:text-red-300"},_a={key:1,class:"space-y-4 md:space-y-5"},wa={class:"mb-2 flex items-center justify-between"},$a={class:"text-xs text-gray-500 dark:text-gray-400 md:text-sm"},Ca={key:0},Sa={key:1,class:"flex items-center gap-1"},Ta={key:0,class:"h-2 w-full rounded-full bg-gray-200 dark:bg-gray-700"},Aa={key:1,class:"h-2 w-full rounded-full bg-gray-200"},Ka={class:"mb-2 flex items-center justify-between"},Ma={class:"text-xs text-gray-500 dark:text-gray-400 md:text-sm"},Pa={key:0},La={key:1,class:"flex items-center gap-1"},Ia={key:0,class:"h-2 w-full rounded-full bg-gray-200 dark:bg-gray-700"},Da={key:1,class:"h-2 w-full rounded-full bg-gray-200"},Ra={key:0},ja={class:"mb-2 flex items-center justify-between"},Ua={class:"text-xs text-gray-500 dark:text-gray-400 md:text-sm"},qa={class:"h-2 w-full rounded-full bg-gray-200 dark:bg-gray-700"},Ea={key:1},Na={class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},Oa={key:0},Fa={key:1},Wa={key:2},Va={class:"space-y-4 border-t border-gray-100 pt-3 dark:border-gray-700"},Ba={class:"flex items-center justify-between"},za={class:"text-sm font-medium text-gray-900 md:text-base"},Ga={key:0},Ha={key:1,class:"flex items-center gap-1"},Ja={class:"flex items-center justify-between"},Qa={class:"text-sm font-medium text-gray-900 md:text-base"},Ya={key:0,class:"text-orange-600"},Xa={key:1,class:"text-green-600"},Za={class:"space-y-2"},er={class:"flex items-center justify-between"},tr={class:"text-sm font-medium text-gray-900 md:text-base"},sr={key:0,class:"text-orange-600"},ar={key:1,class:"text-green-600"},rr={key:0,class:"flex flex-wrap gap-2 rounded-lg bg-blue-50 p-2 dark:bg-blue-900/20 md:p-3"},lr={key:0,class:"card !overflow-visible p-4 md:p-6"},nr={class:"rounded-lg border border-amber-200 bg-amber-50 p-3 dark:border-amber-800 dark:bg-amber-900/20 md:p-4"},ir={class:"max-h-64 space-y-1 overflow-y-auto pr-1 md:max-h-80 md:space-y-2"},or={class:"break-all text-gray-800 dark:text-gray-200"},dr={__name:"LimitConfig",setup(j){const _=ne(),{statsData:r,multiKeyMode:p,aggregatedStats:c,invalidKeys:f}=re(_),y=I(()=>{var a;const m=(a=r.value)==null?void 0:a.restrictions;return m?m.enableModelRestriction===!0&&Array.isArray(m.restrictedModels)&&m.restrictedModels.length>0:!1}),h=I(()=>{var a;const m=(a=r.value)==null?void 0:a.restrictions;return m?m.enableClientRestriction===!0&&Array.isArray(m.allowedClients)&&m.allowedClients.length>0:!1}),$=()=>{if(!r.value.limits.dailyCostLimit||r.value.limits.dailyCostLimit===0)return 0;const m=r.value.limits.currentDailyCost/r.value.limits.dailyCostLimit*100;return Math.min(m,100)},L=()=>{const m=$();return m>=100?"bg-red-500":m>=80?"bg-yellow-500":"bg-green-500"},D=()=>{if(!r.value.limits.totalCostLimit||r.value.limits.totalCostLimit===0)return 0;const m=r.value.limits.currentTotalCost/r.value.limits.totalCostLimit*100;return Math.min(m,100)},g=()=>{const m=D();return m>=100?"bg-red-500":m>=80?"bg-yellow-500":"bg-blue-500"},x=()=>{if(!r.value.limits.weeklyOpusCostLimit||r.value.limits.weeklyOpusCostLimit===0)return 0;const m=r.value.limits.weeklyOpusCost/r.value.limits.weeklyOpusCostLimit*100;return Math.min(m,100)},A=()=>{const m=x();return m>=100?"bg-red-500":m>=80?"bg-yellow-500":"bg-indigo-500"};return(m,a)=>{var b;return n(),o("div",ea,[e("div",ta,[e("h3",sa,[a[0]||(a[0]=e("i",{class:"fas fa-shield-alt mr-2 text-sm text-red-500 md:mr-3 md:text-base"},null,-1)),v(" "+i(t(p)?"限制配置（聚合查询模式）":"限制配置"),1)]),t(p)&&t(c)?(n(),o("div",aa,[e("div",ra,[e("div",la,[a[1]||(a[1]=e("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},[e("i",{class:"fas fa-layer-group mr-2 text-blue-500"}),v(" API Keys 概况 ")],-1)),e("span",na,i(t(c).activeKeys)+"/"+i(t(c).totalKeys),1)]),e("div",ia,[e("div",oa,[e("div",da,i(t(c).totalKeys),1),a[2]||(a[2]=e("div",{class:"text-xs text-gray-600 dark:text-gray-400"},"总计 Keys",-1))]),e("div",ua,[e("div",ca,i(t(c).activeKeys),1),a[3]||(a[3]=e("div",{class:"text-xs text-gray-600 dark:text-gray-400"},"激活 Keys",-1))])])]),e("div",ma,[a[7]||(a[7]=e("div",{class:"mb-3 flex items-center"},[e("i",{class:"fas fa-chart-pie mr-2 text-purple-500"}),e("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"聚合统计摘要")],-1)),e("div",ga,[e("div",xa,[a[4]||(a[4]=e("span",{class:"text-xs text-gray-600 dark:text-gray-400"},[e("i",{class:"fas fa-database mr-1 text-gray-400"}),v(" 总请求数 ")],-1)),e("span",fa,i(t(O)(t(c).usage.requests)),1)]),e("div",ya,[a[5]||(a[5]=e("span",{class:"text-xs text-gray-600 dark:text-gray-400"},[e("i",{class:"fas fa-coins mr-1 text-yellow-500"}),v(" 总 Tokens ")],-1)),e("span",pa,i(t(O)(t(c).usage.allTokens)),1)]),e("div",va,[a[6]||(a[6]=e("span",{class:"text-xs text-gray-600 dark:text-gray-400"},[e("i",{class:"fas fa-dollar-sign mr-1 text-green-500"}),v(" 总费用 ")],-1)),e("span",ba,i(t(c).usage.formattedCost),1)])])]),t(f)&&t(f).length>0?(n(),o("div",ka,[a[8]||(a[8]=e("i",{class:"fas fa-exclamation-triangle mr-2 text-red-600 dark:text-red-400"},null,-1)),e("span",ha,i(t(f).length)+" 个无效的 API Key ",1)])):T("",!0),a[9]||(a[9]=e("div",{class:"rounded-lg bg-gray-50 p-3 text-xs text-gray-600 dark:bg-gray-800 dark:text-gray-400"},[e("i",{class:"fas fa-info-circle mr-1"}),v(" 每个 API Key 有独立的限制设置，聚合模式下不显示单个限制配置 ")],-1))])):T("",!0),!t(p)&&((b=t(r))!=null&&b.limits)?(n(),o("div",_a,[e("div",null,[e("div",wa,[a[11]||(a[11]=e("span",{class:"text-sm font-medium text-gray-600 dark:text-gray-400 md:text-base"},"每日费用限制",-1)),e("span",$a,[t(r).limits.dailyCostLimit>0?(n(),o("span",Ca," $"+i(t(r).limits.currentDailyCost.toFixed(4))+" / $"+i(t(r).limits.dailyCostLimit.toFixed(2)),1)):(n(),o("span",Sa,[v(" $"+i(t(r).limits.currentDailyCost.toFixed(4))+" / ",1),a[10]||(a[10]=e("i",{class:"fas fa-infinity"},null,-1))]))])]),t(r).limits.dailyCostLimit>0?(n(),o("div",Ta,[e("div",{class:M(["h-2 rounded-full transition-all duration-300",L()]),style:de({width:$()+"%"})},null,6)])):(n(),o("div",Aa,a[12]||(a[12]=[e("div",{class:"h-2 rounded-full bg-green-500",style:{width:"0%"}},null,-1)])))]),e("div",null,[e("div",Ka,[a[14]||(a[14]=e("span",{class:"text-sm font-medium text-gray-600 dark:text-gray-400 md:text-base"},"总费用限制",-1)),e("span",Ma,[t(r).limits.totalCostLimit>0?(n(),o("span",Pa," $"+i(t(r).limits.currentTotalCost.toFixed(4))+" / $"+i(t(r).limits.totalCostLimit.toFixed(2)),1)):(n(),o("span",La,[v(" $"+i(t(r).limits.currentTotalCost.toFixed(4))+" / ",1),a[13]||(a[13]=e("i",{class:"fas fa-infinity"},null,-1))]))])]),t(r).limits.totalCostLimit>0?(n(),o("div",Ia,[e("div",{class:M(["h-2 rounded-full transition-all duration-300",g()]),style:de({width:D()+"%"})},null,6)])):(n(),o("div",Da,a[15]||(a[15]=[e("div",{class:"h-2 rounded-full bg-blue-500",style:{width:"0%"}},null,-1)])))]),t(r).limits.weeklyOpusCostLimit>0?(n(),o("div",Ra,[e("div",ja,[a[16]||(a[16]=e("span",{class:"text-sm font-medium text-gray-600 dark:text-gray-400 md:text-base"},"Claude 模型周费用限制",-1)),e("span",Ua," $"+i(t(r).limits.weeklyOpusCost.toFixed(4))+" / $"+i(t(r).limits.weeklyOpusCostLimit.toFixed(2)),1)]),e("div",qa,[e("div",{class:M(["h-2 rounded-full transition-all duration-300",A()]),style:de({width:x()+"%"})},null,6)])])):T("",!0),t(r).limits.rateLimitWindow>0&&(t(r).limits.rateLimitRequests>0||t(r).limits.tokenLimit>0||t(r).limits.rateLimitCost>0)?(n(),o("div",Ea,[te(Ge,{"cost-limit":t(r).limits.rateLimitCost,"current-cost":t(r).limits.currentWindowCost,"current-requests":t(r).limits.currentWindowRequests,"current-tokens":t(r).limits.currentWindowTokens,label:"时间窗口限制","rate-limit-window":t(r).limits.rateLimitWindow,"request-limit":t(r).limits.rateLimitRequests,"show-progress":!0,"show-tooltip":!0,"token-limit":t(r).limits.tokenLimit,"window-end-time":t(r).limits.windowEndTime,"window-remaining-seconds":t(r).limits.windowRemainingSeconds,"window-start-time":t(r).limits.windowStartTime},null,8,["cost-limit","current-cost","current-requests","current-tokens","rate-limit-window","request-limit","token-limit","window-end-time","window-remaining-seconds","window-start-time"]),e("div",Na,[a[17]||(a[17]=e("i",{class:"fas fa-info-circle mr-1"},null,-1)),t(r).limits.rateLimitCost>0?(n(),o("span",Oa,' 请求次数和费用限制为"或"的关系，任一达到限制即触发限流 ')):t(r).limits.tokenLimit>0?(n(),o("span",Fa,' 请求次数和Token使用量为"或"的关系，任一达到限制即触发限流 ')):(n(),o("span",Wa," 仅限制请求次数 "))])])):T("",!0),e("div",Va,[e("div",Ba,[a[19]||(a[19]=e("span",{class:"text-sm text-gray-600 dark:text-gray-400 md:text-base"},"并发限制",-1)),e("span",za,[t(r).limits.concurrencyLimit>0?(n(),o("span",Ga,i(t(r).limits.concurrencyLimit),1)):(n(),o("span",Ha,a[18]||(a[18]=[e("i",{class:"fas fa-infinity text-gray-400"},null,-1)])))])]),e("div",Ja,[a[22]||(a[22]=e("span",{class:"text-sm text-gray-600 dark:text-gray-400 md:text-base"},"模型限制",-1)),e("span",Qa,[y.value?(n(),o("span",Ya,[a[20]||(a[20]=e("i",{class:"fas fa-exclamation-triangle mr-1 text-xs md:text-sm"},null,-1)),v(" 限制 "+i(t(r).restrictions.restrictedModels.length)+" 个模型 ",1)])):(n(),o("span",Xa,a[21]||(a[21]=[e("i",{class:"fas fa-check-circle mr-1 text-xs md:text-sm"},null,-1),v(" 允许所有模型 ",-1)])))])]),e("div",Za,[e("div",er,[a[25]||(a[25]=e("span",{class:"text-sm text-gray-600 dark:text-gray-400 md:text-base"},"客户端限制",-1)),e("span",tr,[h.value?(n(),o("span",sr,[a[23]||(a[23]=e("i",{class:"fas fa-exclamation-triangle mr-1 text-xs md:text-sm"},null,-1)),v(" 限 "+i(t(r).restrictions.allowedClients.length)+" 种客户端使用 ",1)])):(n(),o("span",ar,a[24]||(a[24]=[e("i",{class:"fas fa-check-circle mr-1 text-xs md:text-sm"},null,-1),v(" 允许所有客户端 ",-1)])))])]),h.value?(n(),o("div",rr,[(n(!0),o(J,null,Z(t(r).restrictions.allowedClients,P=>(n(),o("span",{key:P,class:"flex items-center gap-1 rounded-full bg-white px-2 py-1 text-xs text-blue-700 shadow-sm dark:bg-gray-800 dark:text-blue-300 md:text-sm"},[a[26]||(a[26]=e("i",{class:"fas fa-id-badge"},null,-1)),v(" "+i(P),1)]))),128))])):T("",!0)])])])):T("",!0)]),y.value?(n(),o("div",lr,[a[30]||(a[30]=e("h3",{class:"mb-3 flex items-center text-lg font-bold text-gray-900 dark:text-gray-100 md:mb-4 md:text-xl"},[e("i",{class:"fas fa-list-alt mr-2 text-sm text-amber-500 md:mr-3 md:text-base"}),v(" 详细限制信息 ")],-1)),e("div",nr,[a[28]||(a[28]=e("h4",{class:"mb-2 flex items-center text-sm font-bold text-amber-800 dark:text-amber-300 md:mb-3 md:text-base"},[e("i",{class:"fas fa-robot mr-1 text-xs md:mr-2 md:text-sm"}),v(" 受限模型列表 ")],-1)),e("div",ir,[(n(!0),o(J,null,Z(t(r).restrictions.restrictedModels,P=>(n(),o("div",{key:P,class:"rounded border border-amber-200 bg-white px-2 py-1 text-xs dark:border-amber-700 dark:bg-gray-800 md:px-3 md:py-2 md:text-sm"},[a[27]||(a[27]=e("i",{class:"fas fa-ban mr-1 text-xs text-red-500 md:mr-2"},null,-1)),e("span",or,i(P),1)]))),128))]),a[29]||(a[29]=e("p",{class:"mt-2 text-xs text-amber-700 dark:text-amber-400 md:mt-3"},[e("i",{class:"fas fa-info-circle mr-1"}),v(" 此 API Key 不能访问以上列出的模型 ")],-1))])])):T("",!0)])}}},ur=le(dr,[["__scopeId","data-v-e03e5fe5"]]),cr={class:"card h-full p-4 md:p-6"},mr={class:"mb-3 flex flex-col text-lg font-bold text-gray-900 dark:text-gray-100 sm:flex-row sm:items-center md:mb-4 md:text-xl"},gr={class:"text-xs font-normal text-gray-600 dark:text-gray-400 sm:ml-2 md:text-sm"},xr={key:0,class:"space-y-2 md:space-y-3"},fr={class:"mb-1 flex items-center justify-between text-sm"},yr={class:"truncate font-medium text-gray-700 dark:text-gray-300"},pr={class:"text-xs text-gray-600 dark:text-gray-400"},vr={class:"h-2 w-full rounded-full bg-gray-200 dark:bg-gray-700"},br={class:"mt-1 flex items-center justify-between text-xs text-gray-500 dark:text-gray-400"},kr={key:0,class:"border-t border-gray-200 pt-2 dark:border-gray-700"},hr={class:"flex items-center justify-between text-sm text-gray-600 dark:text-gray-400"},_r={key:1,class:"flex h-32 items-center justify-center text-sm text-gray-500 dark:text-gray-400"},wr={key:2,class:"flex h-32 items-center justify-center text-sm text-gray-500 dark:text-gray-400"},$r={__name:"AggregatedStatsCard",setup(j){const _=ne(),{aggregatedStats:r,individualStats:p,statsPeriod:c,multiKeyMode:f}=re(_),y=x=>x?c.value==="daily"?x.dailyUsage||x.usage:x.monthlyUsage||x.usage:null,h=I(()=>!p.value||p.value.length===0?[]:[...p.value].sort((x,A)=>{const m=y(x),a=y(A);return((a==null?void 0:a.cost)||0)-((m==null?void 0:m.cost)||0)}).slice(0,5)),$=I(()=>p.value?Math.max(0,p.value.length-5):0),L=I(()=>{var a,b;if(!p.value||!r.value)return 0;const x=h.value.reduce((P,R)=>{const U=y(R);return P+((U==null?void 0:U.cost)||0)},0),A=c.value==="daily"?((a=r.value.dailyUsage)==null?void 0:a.cost)||0:((b=r.value.monthlyUsage)==null?void 0:b.cost)||0;if(A===0)return 0;const m=A-x;return Math.max(0,Math.round(m/A*100))}),D=x=>{var b,P;if(!r.value)return 0;const A=c.value==="daily"?((b=r.value.dailyUsage)==null?void 0:b.cost)||0:((P=r.value.monthlyUsage)==null?void 0:P.cost)||0;if(A===0)return 0;const m=y(x),a=((m==null?void 0:m.cost)||0)/A*100;return Math.round(a)},g=x=>["bg-blue-500","bg-green-500","bg-purple-500","bg-yellow-500","bg-pink-500"][x]||"bg-gray-400";return(x,A)=>(n(),o("div",cr,[e("h3",mr,[A[0]||(A[0]=e("span",{class:"flex items-center"},[e("i",{class:"fas fa-chart-pie mr-2 text-sm text-orange-500 md:mr-3 md:text-base"}),v(" 使用占比 ")],-1)),e("span",gr,"("+i(t(c)==="daily"?"今日":"本月")+")",1)]),t(r)&&t(p).length>0?(n(),o("div",xr,[(n(!0),o(J,null,Z(h.value,(m,a)=>{var b,P;return n(),o("div",{key:m.apiId,class:"relative"},[e("div",fr,[e("span",yr,i(m.name||`Key ${a+1}`),1),e("span",pr,i(D(m))+"% ",1)]),e("div",vr,[e("div",{class:M(["h-2 rounded-full transition-all duration-300",g(a)]),style:de({width:D(m)+"%"})},null,6)]),e("div",br,[e("span",null,i(t(O)(((b=y(m))==null?void 0:b.requests)||0))+"次",1),e("span",null,i(((P=y(m))==null?void 0:P.formattedCost)||"$0.00"),1)])])}),128)),$.value>0?(n(),o("div",kr,[e("div",hr,[e("span",null,"其他 "+i($.value)+" 个Keys",1),e("span",null,i(L.value)+"%",1)])])):T("",!0)])):t(f)?(n(),o("div",wr,A[2]||(A[2]=[e("i",{class:"fas fa-chart-pie mr-2"},null,-1),v(" 暂无数据 ",-1)]))):(n(),o("div",_r,A[1]||(A[1]=[e("div",{class:"text-center"},[e("i",{class:"fas fa-chart-pie mb-2 text-2xl"}),e("p",null,"使用占比仅在多Key查询时显示")],-1)])))]))}},Cr=le($r,[["__scopeId","data-v-37821008"]]),Sr={class:"card p-3 sm:p-4 md:p-6"},Tr={class:"mb-2 sm:mb-3 md:mb-4"},Ar={class:"flex flex-col text-base font-bold text-gray-900 dark:text-gray-100 sm:flex-row sm:items-center sm:text-lg md:text-xl"},Kr={class:"text-xs font-normal text-gray-600 dark:text-gray-400 sm:ml-2 md:text-sm"},Mr={key:0,class:"py-6 text-center md:py-8"},Pr={key:1,class:"space-y-2"},Lr={class:"flex flex-col gap-1 sm:flex-row sm:items-center sm:justify-between"},Ir={class:"flex flex-col gap-1 sm:flex-row sm:items-center sm:gap-3"},Dr=["onClick"],Rr={class:"flex flex-wrap gap-x-2 text-xs text-gray-500 dark:text-gray-400"},jr={key:0},Ur={key:1},qr={class:"flex-shrink-0 text-xs sm:text-sm"},Er={class:"ml-1 font-semibold text-green-600"},Nr={class:"ml-1 font-semibold text-amber-600 dark:text-amber-400"},Or={key:2,class:"py-6 text-center text-gray-500 dark:text-gray-400 md:py-8"},Fr={class:"text-sm md:text-base"},Wr={__name:"ModelUsageStats",props:{period:{type:String,default:"daily",validator:j=>["daily","monthly","alltime"].includes(j)}},setup(j){const _=j,r=ne(),{dailyModelStats:p,monthlyModelStats:c,alltimeModelStats:f,modelStatsLoading:y,serviceRates:h}=re(r),$=I(()=>_.period==="daily"?p.value:_.period==="monthly"?c.value:_.period==="alltime"?f.value:[]),L=I(()=>y.value),D=I(()=>_.period==="daily"?"今日":_.period==="monthly"?"本月":_.period==="alltime"?"所有时间":""),g=m=>Ke(m,"模型名称已复制"),x=m=>{if(!m)return"claude";const a=m.toLowerCase();return a.includes("claude")||a.includes("sonnet")||a.includes("opus")||a.includes("haiku")?"claude":a.includes("gpt")||a.includes("o1")||a.includes("o3")||a.includes("o4")?"codex":a.includes("gemini")?"gemini":a.includes("droid")||a.includes("factory")?"droid":a.includes("bedrock")||a.includes("amazon")?"bedrock":a.includes("azure")?"azure":"claude"},A=m=>{var U,N,F;if(!m.isLegacy&&((U=m.costs)==null?void 0:U.rated)!==void 0){const W=m.costs.rated;return W>=1?"$"+W.toFixed(2):W>=.01?"$"+W.toFixed(4):"$"+W.toFixed(6)}const a=((N=m.costs)==null?void 0:N.total)||0;if(!a||!((F=h.value)!=null&&F.rates))return"$0.00";const b=x(m.model),P=h.value.rates[b]||1,R=a*P;return R>=1?"$"+R.toFixed(2):R>=.01?"$"+R.toFixed(4):"$"+R.toFixed(6)};return(m,a)=>(n(),o("div",Sr,[e("div",Tr,[e("h3",Ar,[a[0]||(a[0]=e("span",{class:"flex items-center"},[e("i",{class:"fas fa-robot mr-2 text-sm text-indigo-500 md:mr-3 md:text-base"}),v(" 模型使用统计 ")],-1)),e("span",Kr,"("+i(D.value)+")",1)])]),L.value?(n(),o("div",Mr,a[1]||(a[1]=[e("i",{class:"fas fa-spinner loading-spinner mb-2 text-xl text-gray-600 dark:text-gray-400 md:text-2xl"},null,-1),e("p",{class:"text-sm text-gray-600 dark:text-gray-400 md:text-base"},"加载模型统计数据中...",-1)]))):$.value.length>0?(n(),o("div",Pr,[(n(!0),o(J,null,Z($.value,(b,P)=>{var R,U;return n(),o("div",{key:P,class:"model-usage-item"},[e("div",Lr,[e("div",Ir,[e("h4",{class:"cursor-pointer text-sm font-bold text-gray-900 hover:text-indigo-600 dark:text-gray-100 dark:hover:text-indigo-400",title:"点击复制",onClick:N=>g(b.model)},[v(i(b.model)+" ",1),a[2]||(a[2]=e("i",{class:"fas fa-copy ml-1 text-xs text-gray-400"},null,-1))],8,Dr),e("div",Rr,[e("span",null,i(b.requests)+"次",1),e("span",null,"输入:"+i(t(O)(b.inputTokens)),1),e("span",null,"输出:"+i(t(O)(b.outputTokens)),1),b.cacheCreateTokens?(n(),o("span",jr,"缓存创建:"+i(t(O)(b.cacheCreateTokens)),1)):T("",!0),b.cacheReadTokens?(n(),o("span",Ur,"缓存读取:"+i(t(O)(b.cacheReadTokens)),1)):T("",!0)])]),e("div",qr,[a[4]||(a[4]=e("span",{class:"text-gray-500"},"官方API",-1)),e("span",Er,i(((R=b.formatted)==null?void 0:R.total)||"$0.00"),1),(U=t(h))!=null&&U.rates?(n(),o(J,{key:0},[a[3]||(a[3]=e("span",{class:"ml-2 text-gray-500"},"计费",-1)),e("span",Nr,i(A(b)),1)],64)):T("",!0)])])])}),128))])):(n(),o("div",Or,[a[5]||(a[5]=e("i",{class:"fas fa-chart-pie mb-3 text-2xl md:text-3xl"},null,-1)),e("p",Fr,"暂无"+i(D.value)+"模型使用数据",1)]))]))}},Vr=le(Wr,[["__scopeId","data-v-0571e613"]]),Br={key:0,class:"fixed inset-0 z-[1050] flex items-center justify-center bg-gray-900/40 backdrop-blur-sm"},zr={class:"relative z-10 mx-3 flex w-full max-w-lg flex-col overflow-hidden rounded-2xl border border-gray-200/70 bg-white/95 shadow-2xl ring-1 ring-black/5 transition-all dark:border-gray-700/60 dark:bg-gray-900/95 dark:ring-white/10 sm:mx-4"},Gr={class:"flex items-center justify-between border-b border-gray-100 bg-white/80 px-5 py-4 backdrop-blur dark:border-gray-800 dark:bg-gray-900/80"},Hr={class:"flex items-center gap-3"},Jr={class:"text-xs text-gray-500 dark:text-gray-400"},Qr=["disabled"],Yr={class:"max-h-[70vh] overflow-y-auto px-5 py-4"},Xr={class:"mb-4"},Zr={class:"relative"},el=["value"],tl={class:"mb-4 space-y-2"},sl={class:"flex items-center justify-between text-sm"},al={class:"inline-flex items-center gap-1.5 rounded-full bg-blue-100 px-2.5 py-0.5 text-xs font-medium text-blue-700 dark:bg-blue-500/20 dark:text-blue-300"},rl={class:"text-sm"},ll={class:"mb-1 flex items-center justify-between"},nl=["value"],il={class:"text-right text-xs text-gray-400 dark:text-gray-500"},ol={class:"text-sm"},dl={class:"mb-1 flex items-center justify-between"},ul=["value"],cl={class:"flex items-center justify-between text-sm"},ml={class:"font-medium text-gray-700 dark:text-gray-300"},gl={class:"mb-4"},xl={class:"flex items-center gap-3"},fl={class:"text-xs text-gray-500 dark:text-gray-400"},yl={key:0,class:"mb-4 overflow-hidden rounded-xl border border-gray-200 bg-gray-50 dark:border-gray-700 dark:bg-gray-800/50"},pl={class:"flex items-center justify-between border-b border-gray-200 bg-gray-100 px-3 py-2 dark:border-gray-700 dark:bg-gray-800"},vl={key:0,class:"text-xs text-gray-500 dark:text-gray-500"},bl={class:"max-h-40 overflow-y-auto p-3"},kl={key:0,class:"whitespace-pre-wrap text-sm text-gray-700 dark:text-gray-300"},hl={key:0,class:"inline-block h-4 w-1 animate-pulse bg-blue-500"},_l={key:1,class:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400"},wl={key:2,class:"text-sm text-red-600 dark:text-red-400"},$l={key:1,class:"mb-4 flex items-center justify-center gap-2 text-xs text-gray-500 dark:text-gray-400"},Cl={class:"flex items-center justify-end gap-3 border-t border-gray-100 bg-gray-50/80 px-5 py-3 dark:border-gray-800 dark:bg-gray-900/50"},Sl=["disabled"],Tl=["disabled"],Al={__name:"ApiKeyTestModal",props:{show:{type:Boolean,default:!1},apiKeyValue:{type:String,default:""},apiKeyName:{type:String,default:""},serviceType:{type:String,default:"claude",validator:j=>["claude","gemini","openai"].includes(j)}},emits:["close"],setup(j,{emit:_}){const r=j,p=_,c=C("idle"),f=C(""),y=C(""),h=C(0),$=C(null),L=C(null),D=C("claude-sonnet-4-5-20250929"),g=C("hi"),x=C(1e3),A=[{value:100,label:"100"},{value:500,label:"500"},{value:1e3,label:"1000"},{value:2e3,label:"2000"},{value:4096,label:"4096"}],m=C({claude:[],gemini:[],openai:[]}),a=async()=>{try{const l=await Fe();l.success&&l.data&&(m.value={claude:l.data.claude||[],gemini:l.data.gemini||[],openai:l.data.openai||[]})}catch(l){console.error("Failed to load models:",l)}},b=I(()=>{const l={claude:{name:"Claude",endpoint:"/api-key/test",defaultModel:"claude-sonnet-4-5-20250929",displayEndpoint:"/api/v1/messages"},gemini:{name:"Gemini",endpoint:"/api-key/test-gemini",defaultModel:"gemini-2.5-pro",displayEndpoint:"/gemini/v1/models/:model:streamGenerateContent"},openai:{name:"OpenAI (Codex)",endpoint:"/api-key/test-openai",defaultModel:"gpt-5",displayEndpoint:"/openai/responses"}};return l[r.serviceType]||l.claude}),P=I(()=>m.value[r.serviceType]||[]);Te(()=>{a()});const R=I(()=>r.apiKeyName||"当前 API Key"),U=I(()=>{const l=r.apiKeyValue;return l?l.length<=10?"****":l.substring(0,6)+"****"+l.substring(l.length-4):""}),N=I(()=>{switch(c.value){case"idle":return"准备就绪";case"testing":return"正在测试...";case"success":return"测试成功";case"error":return"测试失败";default:return"未知状态"}}),F=I(()=>{switch(c.value){case"idle":return"点击下方按钮开始测试 API Key 连通性";case"testing":return"正在通过 /api 端点发送测试请求";case"success":return"API Key 可以正常访问服务";case"error":return y.value||"无法通过 API Key 访问服务";default:return""}}),W=I(()=>{switch(c.value){case"idle":return"border-gray-200 bg-gray-50 dark:border-gray-700 dark:bg-gray-800/50";case"testing":return"border-blue-200 bg-blue-50 dark:border-blue-500/30 dark:bg-blue-900/20";case"success":return"border-green-200 bg-green-50 dark:border-green-500/30 dark:bg-green-900/20";case"error":return"border-red-200 bg-red-50 dark:border-red-500/30 dark:bg-red-900/20";default:return"border-gray-200 bg-gray-50 dark:border-gray-700 dark:bg-gray-800/50"}}),Y=I(()=>{switch(c.value){case"idle":return"bg-gray-200 dark:bg-gray-700";case"testing":return"bg-blue-100 dark:bg-blue-500/30";case"success":return"bg-green-100 dark:bg-green-500/30";case"error":return"bg-red-100 dark:bg-red-500/30";default:return"bg-gray-200 dark:bg-gray-700"}}),Q=I(()=>{switch(c.value){case"idle":return"fa-hourglass-start";case"testing":return"fa-spinner fa-spin";case"success":return"fa-check-circle";case"error":return"fa-exclamation-circle";default:return"fa-question-circle"}}),E=I(()=>{switch(c.value){case"idle":return"text-gray-500 dark:text-gray-400";case"testing":return"text-blue-500 dark:text-blue-400";case"success":return"text-green-500 dark:text-green-400";case"error":return"text-red-500 dark:text-red-400";default:return"text-gray-500 dark:text-gray-400"}}),S=I(()=>{switch(c.value){case"idle":return"text-gray-700 dark:text-gray-300";case"testing":return"text-blue-700 dark:text-blue-300";case"success":return"text-green-700 dark:text-green-300";case"error":return"text-red-700 dark:text-red-300";default:return"text-gray-700 dark:text-gray-300"}});async function X(){if(!r.apiKeyValue)return;c.value="testing",f.value="",y.value="",h.value=0,$.value=Date.now(),L.value&&L.value.abort(),L.value=new AbortController;const l=`${We.apiPrefix}/apiStats${b.value.endpoint}`;try{const s=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apiKey:r.apiKeyValue,model:D.value,prompt:g.value,maxTokens:x.value}),signal:L.value.signal});if(!s.ok){const V=await s.json().catch(()=>({}));throw new Error(V.message||V.error||`HTTP ${s.status}`)}const d=s.body.getReader(),w=new TextDecoder;let q=!1;for(;!q;){const{done:V,value:ie}=await d.read();if(V){q=!0;continue}const oe=w.decode(ie).split(`
`);for(const H of oe)if(H.startsWith("data: "))try{const se=JSON.parse(H.substring(6));ee(se)}catch{}}}catch(s){if(s.name==="AbortError")return;c.value="error",y.value=s.message||"连接失败",h.value=Date.now()-$.value}}function ee(l){switch(l.type){case"test_start":break;case"content":f.value+=l.text;break;case"message_stop":break;case"test_complete":h.value=Date.now()-$.value,l.success?c.value="success":(c.value="error",y.value=l.error||"测试失败");break;case"error":c.value="error",y.value=l.error||"未知错误",h.value=Date.now()-$.value;break}}function G(){c.value!=="testing"&&(L.value&&(L.value.abort(),L.value=null),c.value="idle",f.value="",y.value="",h.value=0,p("close"))}return pe(()=>r.show,l=>{l&&(c.value="idle",f.value="",y.value="",h.value=0,D.value=b.value.defaultModel,g.value="hi",x.value=1e3)}),pe(()=>r.serviceType,()=>{D.value=b.value.defaultModel}),Ae(()=>{L.value&&L.value.abort()}),(l,s)=>(n(),me(De,{to:"body"},[j.show?(n(),o("div",Br,[e("div",{class:"absolute inset-0",onClick:G}),e("div",zr,[e("div",Gr,[e("div",Hr,[e("div",{class:M(["flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-xl text-white shadow-lg",c.value==="success"?"bg-gradient-to-br from-green-500 to-emerald-500":c.value==="error"?"bg-gradient-to-br from-red-500 to-pink-500":"bg-gradient-to-br from-blue-500 to-indigo-500"])},[e("i",{class:M(["fas",c.value==="idle"?"fa-vial":c.value==="testing"?"fa-spinner fa-spin":c.value==="success"?"fa-check":"fa-times"])},null,2)],2),e("div",null,[s[3]||(s[3]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-gray-100"}," API Key 端点测试 ",-1)),e("p",Jr,i(R.value),1)])]),e("button",{class:"flex h-9 w-9 items-center justify-center rounded-full bg-gray-100 text-gray-500 transition hover:bg-gray-200 hover:text-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-gray-200",disabled:c.value==="testing",onClick:G},s[4]||(s[4]=[e("i",{class:"fas fa-times text-sm"},null,-1)]),8,Qr)]),e("div",Yr,[e("div",Xr,[s[6]||(s[6]=e("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," API Key ",-1)),e("div",Zr,[e("input",{class:"w-full rounded-lg border border-gray-200 bg-gray-50 px-3 py-2 pr-10 text-sm text-gray-700 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",readonly:"",type:"text",value:U.value},null,8,el),s[5]||(s[5]=e("div",{class:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400"},[e("i",{class:"fas fa-lock text-xs"})],-1))]),s[7]||(s[7]=e("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," 测试将使用此 API Key 调用当前服务的 /api 端点 ",-1))]),e("div",tl,[e("div",sl,[s[9]||(s[9]=e("span",{class:"text-gray-500 dark:text-gray-400"},"测试端点",-1)),e("span",al,[s[8]||(s[8]=e("i",{class:"fas fa-link"},null,-1)),v(" "+i(b.value.displayEndpoint),1)])]),e("div",rl,[e("div",ll,[s[10]||(s[10]=e("span",{class:"text-gray-500 dark:text-gray-400"},"测试模型",-1)),ge(e("select",{"onUpdate:modelValue":s[0]||(s[0]=d=>D.value=d),class:"rounded-lg border border-gray-200 bg-white px-2 py-1 text-sm text-gray-700 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-300"},[(n(!0),o(J,null,Z(P.value,d=>(n(),o("option",{key:d.value,value:d.value},i(d.label),9,nl))),128))],512),[[_e,D.value]])]),e("div",il,i(D.value),1)]),e("div",ol,[e("div",dl,[s[11]||(s[11]=e("span",{class:"text-gray-500 dark:text-gray-400"},"最大输出 Token",-1)),ge(e("select",{"onUpdate:modelValue":s[1]||(s[1]=d=>x.value=d),class:"rounded-lg border border-gray-200 bg-white px-2 py-1 text-sm text-gray-700 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-300"},[(n(),o(J,null,Z(A,d=>e("option",{key:d.value,value:d.value},i(d.label),9,ul)),64))],512),[[_e,x.value]])])]),e("div",cl,[s[12]||(s[12]=e("span",{class:"text-gray-500 dark:text-gray-400"},"测试服务",-1)),e("span",ml,i(b.value.name),1)])]),e("div",gl,[s[13]||(s[13]=e("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," 提示词 ",-1)),ge(e("textarea",{"onUpdate:modelValue":s[2]||(s[2]=d=>g.value=d),class:"w-full rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm text-gray-700 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",placeholder:"输入测试提示词...",rows:"2"},null,512),[[Se,g.value]])]),e("div",{class:M(["mb-4 rounded-xl border p-4 transition-all duration-300",W.value])},[e("div",xl,[e("div",{class:M(["flex h-8 w-8 items-center justify-center rounded-lg",Y.value])},[e("i",{class:M(["fas text-sm",Q.value,E.value])},null,2)],2),e("div",null,[e("p",{class:M(["font-medium",S.value])},i(N.value),3),e("p",fl,i(F.value),1)])])],2),c.value!=="idle"?(n(),o("div",yl,[e("div",pl,[s[14]||(s[14]=e("span",{class:"text-xs font-medium text-gray-600 dark:text-gray-400"},"AI 响应",-1)),f.value?(n(),o("span",vl,i(f.value.length)+" 字符 ",1)):T("",!0)]),e("div",bl,[f.value?(n(),o("p",kl,[v(i(f.value)+" ",1),c.value==="testing"?(n(),o("span",hl)):T("",!0)])):c.value==="testing"?(n(),o("p",_l,s[15]||(s[15]=[e("i",{class:"fas fa-circle-notch fa-spin"},null,-1),v(" 等待响应中... ",-1)]))):c.value==="error"&&y.value?(n(),o("p",wl,i(y.value),1)):T("",!0)])])):T("",!0),h.value>0?(n(),o("div",$l,[s[16]||(s[16]=e("i",{class:"fas fa-clock"},null,-1)),e("span",null,"耗时 "+i((h.value/1e3).toFixed(2))+" 秒",1)])):T("",!0)]),e("div",Cl,[e("button",{class:"rounded-lg border border-gray-200 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm transition hover:bg-gray-50 hover:shadow dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700",disabled:c.value==="testing",onClick:G}," 关闭 ",8,Sl),e("button",{class:M(["flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium shadow-sm transition",c.value==="testing"||!j.apiKeyValue?"cursor-not-allowed bg-gray-200 text-gray-400 dark:bg-gray-700 dark:text-gray-500":"bg-gradient-to-r from-blue-500 to-indigo-500 text-white hover:from-blue-600 hover:to-indigo-600 hover:shadow-md"]),disabled:c.value==="testing"||!j.apiKeyValue,onClick:X},[e("i",{class:M(["fas",c.value==="testing"?"fa-spinner fa-spin":"fa-play"])},null,2),v(" "+i(c.value==="testing"?"测试中...":c.value==="idle"?"开始测试":"重新测试"),1)],10,Tl)])])])):T("",!0)]))}},Kl={class:"glass-strong mb-6 rounded-3xl p-4 shadow-xl md:mb-8 md:p-6"},Ml={class:"flex flex-col items-center justify-between gap-4 md:flex-row"},Pl={class:"flex items-center gap-2 md:gap-4"},Ll={class:"flex items-center"},Il={key:0,class:"h-8 w-px bg-gradient-to-b from-transparent via-gray-300 to-transparent opacity-50 dark:via-gray-600"},Dl={class:"mb-6 md:mb-8"},Rl={class:"flex justify-center"},jl={class:"inline-flex w-full max-w-md rounded-full border border-white/20 bg-white/10 p-1 shadow-lg backdrop-blur-xl md:w-auto"},Ul={key:0,class:"tab-content"},ql={key:0,class:"mb-6 md:mb-8"},El={class:"rounded-xl border border-red-500/30 bg-red-500/20 p-3 text-sm text-red-800 backdrop-blur-sm dark:border-red-500/20 dark:bg-red-500/10 dark:text-red-200 md:p-4 md:text-base"},Nl={key:1,class:"fade-in"},Ol={class:"glass-strong rounded-3xl p-4 shadow-xl md:p-6"},Fl={class:"mb-4 border-b border-gray-200 pb-4 dark:border-gray-700 md:mb-6 md:pb-6"},Wl={class:"flex flex-col items-start justify-between gap-3 md:flex-row md:items-center md:gap-4"},Vl={class:"flex w-full items-center gap-2 md:w-auto"},Bl=["disabled"],zl=["disabled"],Gl=["disabled"],Hl={class:"mb-6 mt-6 grid grid-cols-1 gap-4 md:mb-8 md:mt-8 md:gap-6 xl:grid-cols-2 xl:items-stretch"},Jl={key:1,class:"tab-content"},Ql={class:"glass-strong rounded-3xl shadow-xl"},Yl={__name:"ApiStatsView",setup(j){const _=Re(),r=ne(),p=Ve(),c=C("stats"),f=I(()=>p.isDarkMode),{apiKey:y,apiId:h,loading:$,modelStatsLoading:L,oemLoading:D,error:g,statsPeriod:x,statsData:A,oemSettings:m,multiKeyMode:a}=re(r),{queryStats:b,switchPeriod:P,loadStatsWithApiId:R,loadOemSettings:U,reset:N}=r,F=C(!1),W=()=>{F.value=!0},Y=()=>{F.value=!1},Q=E=>{(E.ctrlKey||E.metaKey)&&E.key==="Enter"&&(!$.value&&y.value.trim()&&b(),E.preventDefault()),E.key==="Escape"&&N()};return Te(()=>{p.initTheme(),U();const E=_.query.apiId,S=_.query.apiKey;E&&E.match(/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/i)?(h.value=E,R()):S&&S.length>10&&(y.value=S),document.addEventListener("keydown",Q)}),Ae(()=>{document.removeEventListener("keydown",Q)}),pe(y,E=>{E||r.clearData()}),(E,S)=>{var ee;const X=je("router-link");return n(),o("div",{class:M(["min-h-screen p-4 md:p-6",f.value?"gradient-bg-dark":"gradient-bg"])},[e("div",Kl,[e("div",Ml,[te(Be,{loading:t(D),"logo-src":t(m).siteIconData||t(m).siteIcon,subtitle:c.value==="stats"?"API Key 使用统计":"使用教程",title:t(m).siteName},null,8,["loading","logo-src","subtitle","title"]),e("div",Pl,[e("div",Ll,[te(ze,{mode:"dropdown"})]),t(m).ldapEnabled||t(m).showAdminButton!==!1?(n(),o("div",Il)):T("",!0),t(m).ldapEnabled?(n(),me(X,{key:1,class:"user-login-button flex items-center gap-2 rounded-2xl px-4 py-2 text-white transition-all duration-300 md:px-5 md:py-2.5",to:"/user-login"},{default:we(()=>S[4]||(S[4]=[e("i",{class:"fas fa-user text-sm md:text-base"},null,-1),e("span",{class:"text-xs font-semibold tracking-wide md:text-sm"},"用户登录",-1)])),_:1,__:[4]})):T("",!0),t(m).showAdminButton!==!1?(n(),me(X,{key:2,class:"admin-button-refined flex items-center gap-2 rounded-2xl px-4 py-2 transition-all duration-300 md:px-5 md:py-2.5",to:"/dashboard"},{default:we(()=>S[5]||(S[5]=[e("i",{class:"fas fa-shield-alt text-sm md:text-base"},null,-1),e("span",{class:"text-xs font-semibold tracking-wide md:text-sm"},"管理后台",-1)])),_:1,__:[5]})):T("",!0)])])]),e("div",Dl,[e("div",Rl,[e("div",jl,[e("button",{class:M(["tab-pill-button",c.value==="stats"?"active":""]),onClick:S[0]||(S[0]=G=>c.value="stats")},S[6]||(S[6]=[e("i",{class:"fas fa-chart-line mr-1 md:mr-2"},null,-1),e("span",{class:"text-sm md:text-base"},"统计查询",-1)]),2),e("button",{class:M(["tab-pill-button",c.value==="tutorial"?"active":""]),onClick:S[1]||(S[1]=G=>c.value="tutorial")},S[7]||(S[7]=[e("i",{class:"fas fa-graduation-cap mr-1 md:mr-2"},null,-1),e("span",{class:"text-sm md:text-base"},"使用教程",-1)]),2)])])]),c.value==="stats"?(n(),o("div",Ul,[te(ft),t(g)?(n(),o("div",ql,[e("div",El,[S[8]||(S[8]=e("i",{class:"fas fa-exclamation-triangle mr-2"},null,-1)),v(" "+i(t(g)),1)])])):T("",!0),t(A)?(n(),o("div",Nl,[e("div",Ol,[e("div",Fl,[e("div",Wl,[S[12]||(S[12]=e("div",{class:"flex items-center gap-2 md:gap-3"},[e("i",{class:"fas fa-clock text-base text-blue-500 md:text-lg"}),e("span",{class:"text-base font-medium text-gray-700 dark:text-gray-200 md:text-lg"},"统计时间范围")],-1)),e("div",Vl,[e("button",{class:M(["flex flex-1 items-center justify-center gap-1 px-4 py-2 text-xs font-medium md:flex-none md:gap-2 md:px-6 md:text-sm",["period-btn",{active:t(x)==="daily"}]]),disabled:t($)||t(L),onClick:S[2]||(S[2]=G=>t(P)("daily"))},S[9]||(S[9]=[e("i",{class:"fas fa-calendar-day text-xs md:text-sm"},null,-1),v(" 今日 ",-1)]),10,Bl),e("button",{class:M(["flex flex-1 items-center justify-center gap-1 px-4 py-2 text-xs font-medium md:flex-none md:gap-2 md:px-6 md:text-sm",["period-btn",{active:t(x)==="monthly"}]]),disabled:t($)||t(L),onClick:S[3]||(S[3]=G=>t(P)("monthly"))},S[10]||(S[10]=[e("i",{class:"fas fa-calendar-alt text-xs md:text-sm"},null,-1),v(" 本月 ",-1)]),10,zl),t(a)?T("",!0):(n(),o("button",{key:0,class:"test-btn flex items-center justify-center gap-1 px-4 py-2 text-xs font-medium md:gap-2 md:px-6 md:text-sm",disabled:t($),onClick:W},S[11]||(S[11]=[e("i",{class:"fas fa-vial text-xs md:text-sm"},null,-1),v(" 测试 ",-1)]),8,Gl))])])]),te(Rs),e("div",Hl,[te(Zs,{class:"h-full"}),t(a)?(n(),me(Cr,{key:0,class:"h-full"})):(n(),me(ur,{key:1,class:"h-full"}))]),te(Vr)])])):T("",!0)])):T("",!0),c.value==="tutorial"?(n(),o("div",Jl,[e("div",Ql,[te(He)])])):T("",!0),te(Al,{"api-key-name":((ee=t(A))==null?void 0:ee.name)||"","api-key-value":t(y),show:F.value,onClose:Y},null,8,["api-key-name","api-key-value","show"])],2)}}},nn=le(Yl,[["__scopeId","data-v-fbaf8f6d"]]);export{nn as default};
